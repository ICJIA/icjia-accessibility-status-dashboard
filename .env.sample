################################################################################
# ICJIA Accessibility Status Portal - Environment Configuration
################################################################################
#
# This file contains all environment variables needed for the application.
# Copy this file to .env and fill in the values for your environment.
#
# REQUIRED vs OPTIONAL:
#   [REQUIRED] - Must be set for the application to function
#   [OPTIONAL] - Has sensible defaults, can be customized
#
# DEVELOPMENT vs PRODUCTION:
#   Dev values are suitable for local development
#   Prod values are for production deployment
#
################################################################################

################################################################################
# 1. SUPABASE CONFIGURATION [REQUIRED]
################################################################################
# Get these values from your Supabase project dashboard:
# https://app.supabase.com → Project Settings → API
#
# VITE_SUPABASE_URL: Your Supabase project URL
#   - Format: https://[project-ref].supabase.co
#   - Find at: Settings → API → Project URL
#   - Used by: Frontend and Backend for database access
#   - Dev example: https://xxxxxxxxxxxxx.supabase.co
#   - Prod example: https://xxxxxxxxxxxxx.supabase.co (same for all environments)
VITE_SUPABASE_URL=https://your-project-ref.supabase.co

# VITE_SUPABASE_ANON_KEY: Your Supabase anonymous key
#   - Format: Long JWT token starting with eyJ...
#   - Find at: Settings → API → Project API Keys → anon (public)
#   - Used by: Frontend for Supabase authentication
#   - Security: This is a public key, safe to expose in frontend
#   - Dev example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
#   - Prod example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
VITE_SUPABASE_ANON_KEY=your-supabase-anon-key-here

# SUPABASE_SERVICE_ROLE_KEY: Your Supabase service role key (BACKEND ONLY) [REQUIRED]
#   - Format: Long JWT token starting with eyJ...
#   - Find at: Settings → API → Project API Keys → service_role (secret)
#   - Used by: Backend ONLY for database operations (bypasses RLS)
#   - Security: KEEP THIS SECRET! Never expose in frontend or public code
#   - Dev example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
#   - Prod example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
#   - Note: Required for backend to write to database with RLS policies
SUPABASE_SERVICE_ROLE_KEY=your-supabase-service-role-key-here

################################################################################
# 2. NODE ENVIRONMENT [OPTIONAL]
################################################################################
# NODE_ENV: Specifies the application environment
#   - Values: development | production
#   - Default: development (if not set)
#   - Dev: development (enables hot reload, verbose logging)
#   - Prod: production (optimized, minimal logging)
#   - Used by: Express and all dependencies
#   - Note: Set by PM2 ecosystem.config.js in production
NODE_ENV=development

################################################################################
# 3. BACKEND SERVER CONFIGURATION [OPTIONAL]
################################################################################
# PORT: Port for Express backend API server
#   - Default: 3001
#   - Dev: 3001 (local development)
#   - Prod: 3001 (managed by PM2, proxied by Nginx)
#   - Used by: Express server (server/index.ts)
#   - Note: Nginx reverse proxy routes /api/* to this port
PORT=3001

################################################################################
# 4. FRONTEND CONFIGURATION [REQUIRED]
################################################################################
# FRONTEND_URL: Frontend URL for CORS configuration
#   - Purpose: Tells backend which frontend domain to allow
#   - Used by: Express CORS middleware (server/index.ts)
#   - Dev: http://localhost:5174 (Vite dev server mapped from container port 5173)
#   - Prod: https://accessibility.icjia.app (production domain)
#   - Security: Only this URL can make cross-origin requests to backend
#   - Note: Must match the domain where frontend is served
FRONTEND_URL=http://localhost:5174

################################################################################
# 5. API CONFIGURATION [REQUIRED]
################################################################################
# VITE_API_URL: Backend API URL used by frontend
#   - Purpose: Tells frontend where to send API requests
#   - Used by: Frontend API client (src/lib/api.ts), vite.config.ts proxy
#   - Dev: http://localhost:3001/api (local backend)
#   - Prod: https://accessibility.icjia.app/api (production domain)
#   - Note: Frontend makes requests to this URL
#   - Note: In production, Nginx proxies /api/* to backend:3001
VITE_API_URL=http://localhost:3001/api

################################################################################
# 6. RATE LIMITING CONFIGURATION [OPTIONAL]
################################################################################
# All rate limiting values are configurable and can be adjusted based on needs.
# Times are in milliseconds (ms).

# LOGIN_RATE_LIMIT_WINDOW_MS: Time window for login rate limiting
#   - Default: 600000 (10 minutes)
#   - Used by: Login endpoint rate limiter
#   - Adjust: Increase for stricter limits, decrease for more lenient
LOGIN_RATE_LIMIT_WINDOW_MS=600000

# LOGIN_RATE_LIMIT_MAX_ATTEMPTS: Max login attempts per IP in the window
#   - Dev: 1000 (disabled for development testing)
#   - Prod: 5 attempts (prevents brute force attacks)
#   - Used by: Login endpoint rate limiter
#   - Security: Prevents brute force attacks
#   - Adjust: Lower for stricter security, higher for user convenience
LOGIN_RATE_LIMIT_MAX_ATTEMPTS=1000

# SESSION_RATE_LIMIT_WINDOW_MS: Time window for session creation rate limiting
#   - Default: 3600000 (1 hour)
#   - Used by: Session creation endpoint
#   - Adjust: Increase for longer windows, decrease for shorter windows
SESSION_RATE_LIMIT_WINDOW_MS=3600000

# SESSION_RATE_LIMIT_MAX_SESSIONS: Max sessions per IP in the window
#   - Dev: 1000 (disabled for development testing)
#   - Prod: 10 sessions per hour (prevents session flooding attacks)
#   - Used by: Session creation endpoint
#   - Security: Prevents session flooding attacks
#   - Adjust: Increase for more sessions, decrease for stricter limits
SESSION_RATE_LIMIT_MAX_SESSIONS=1000

# GENERAL_RATE_LIMIT_WINDOW_MS: Time window for general API rate limiting
#   - Default: 3600000 (1 hour)
#   - Used by: All API endpoints (fallback rate limiter)
#   - Adjust: Increase for longer windows, decrease for shorter windows
GENERAL_RATE_LIMIT_WINDOW_MS=3600000

# GENERAL_RATE_LIMIT_MAX_REQUESTS: Max requests per IP in the window
#   - Dev: 10000 (disabled for development testing)
#   - Prod: 1000 requests per hour (fallback rate limiter)
#   - Used by: All API endpoints (fallback rate limiter)
#   - Adjust: Increase for higher throughput, decrease for stricter limits
GENERAL_RATE_LIMIT_MAX_REQUESTS=10000

################################################################################
# QUICK START GUIDE
################################################################################
#
# DEVELOPMENT SETUP:
# 1. Copy this file: cp .env.sample .env
# 2. Fill in Supabase credentials (VITE_SUPABASE_URL, VITE_SUPABASE_ANON_KEY)
# 3. Keep other values as defaults
# 4. Run: yarn dev
#
# PRODUCTION SETUP:
# 1. Copy this file: cp .env.sample .env
# 2. Fill in Supabase credentials (same as development)
# 3. Update FRONTEND_URL to production domain (e.g., https://accessibility.icjia.app)
# 4. Update VITE_API_URL to production domain (e.g., https://accessibility.icjia.app/api)
# 5. Set NODE_ENV=production
# 6. Keep rate limiting values or adjust as needed
# 7. Deploy with PM2: yarn production:pm2
#
# VERIFICATION:
# 1. Backend health check: curl http://localhost:3001/api/health
# 2. Frontend: http://localhost:5173
# 3. View PM2 status: pm2 status
# 4. View logs: pm2 logs
#
################################################################################
