"use strict";(self.webpackChunkicjia_accessibility_docs=self.webpackChunkicjia_accessibility_docs||[]).push([[5503],{3023:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>c});var i=n(3696);const a={},t=i.createContext(a);function l(e){const s=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),i.createElement(t.Provider,{value:s},e.children)}},5094:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>r,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"deployment/database-backups","title":"Database Backups","description":"This guide explains how to manage and verify database backups for the ICJIA Accessibility Status Portal.","source":"@site/docs/deployment/database-backups.md","sourceDirName":"deployment","slug":"/deployment/database-backups","permalink":"/docs/docs/deployment/database-backups","draft":false,"unlisted":false,"editUrl":"https://github.com/ICJIA/icjia-accessibility-status/tree/main/docs/docs/deployment/database-backups.md","tags":[],"version":"current","frontMatter":{}}');var a=n(2540),t=n(3023);const l={},c="Database Backups",r={},o=[{value:"Overview",id:"overview",level:2},{value:"Supabase Automated Backups",id:"supabase-automated-backups",level:2},{value:"Backup Schedule",id:"backup-schedule",level:3},{value:"Accessing Backups",id:"accessing-backups",level:3},{value:"Backup Contents",id:"backup-contents",level:3},{value:"Backup Verification Checklist",id:"backup-verification-checklist",level:2},{value:"Weekly Verification (Every Monday)",id:"weekly-verification-every-monday",level:3},{value:"Monthly Restore Test (First Friday of Month)",id:"monthly-restore-test-first-friday-of-month",level:3},{value:"Step 1: Create Staging Database",id:"step-1-create-staging-database",level:4},{value:"Step 2: Download Backup",id:"step-2-download-backup",level:4},{value:"Step 3: Restore to Staging",id:"step-3-restore-to-staging",level:4},{value:"Step 4: Verify Restore",id:"step-4-verify-restore",level:4},{value:"Step 5: Test Data Integrity",id:"step-5-test-data-integrity",level:4},{value:"Step 6: Test Application Connection",id:"step-6-test-application-connection",level:4},{value:"Step 7: Cleanup",id:"step-7-cleanup",level:4},{value:"Backup Disaster Recovery Plan",id:"backup-disaster-recovery-plan",level:2},{value:"If Production Database is Corrupted",id:"if-production-database-is-corrupted",level:3},{value:"If Backup is Corrupted",id:"if-backup-is-corrupted",level:3},{value:"Backup Retention Policy",id:"backup-retention-policy",level:2},{value:"Development",id:"development",level:3},{value:"Production",id:"production",level:3},{value:"Archive",id:"archive",level:3},{value:"Automated Backup Exports",id:"automated-backup-exports",level:2},{value:"Daily Export to S3",id:"daily-export-to-s3",level:3},{value:"Setup Cron Job",id:"setup-cron-job",level:3},{value:"Production Deployment Checklist",id:"production-deployment-checklist",level:2},{value:"Monitoring Backup Health",id:"monitoring-backup-health",level:2},{value:"Supabase Backup Alerts",id:"supabase-backup-alerts",level:3},{value:"Custom Monitoring",id:"custom-monitoring",level:3},{value:"See Also",id:"see-also",level:2}];function d(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.header,{children:(0,a.jsx)(s.h1,{id:"database-backups",children:"Database Backups"})}),"\n",(0,a.jsx)(s.p,{children:"This guide explains how to manage and verify database backups for the ICJIA Accessibility Status Portal."}),"\n",(0,a.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,a.jsx)(s.p,{children:"The application uses Supabase (PostgreSQL) for data storage. Supabase provides automated daily backups, but it's critical to verify backups are working and test restore procedures regularly."}),"\n",(0,a.jsx)(s.h2,{id:"supabase-automated-backups",children:"Supabase Automated Backups"}),"\n",(0,a.jsx)(s.h3,{id:"backup-schedule",children:"Backup Schedule"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Frequency:"})," Daily"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Retention:"})," 7 days (free tier) or 30 days (paid tier)"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Time:"})," 2:00 AM UTC (configurable)"]}),"\n",(0,a.jsxs)(s.li,{children:[(0,a.jsx)(s.strong,{children:"Location:"})," Geographically redundant storage"]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"accessing-backups",children:"Accessing Backups"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:["Go to ",(0,a.jsx)(s.a,{href:"https://app.supabase.com",children:"Supabase Dashboard"})]}),"\n",(0,a.jsx)(s.li,{children:"Select your project"}),"\n",(0,a.jsxs)(s.li,{children:["Go to ",(0,a.jsx)(s.strong,{children:"Settings \u2192 Backups"})]}),"\n",(0,a.jsx)(s.li,{children:"View backup history and download options"}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"backup-contents",children:"Backup Contents"}),"\n",(0,a.jsx)(s.p,{children:"Each backup includes:"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"All database tables"}),"\n",(0,a.jsx)(s.li,{children:"All data"}),"\n",(0,a.jsx)(s.li,{children:"Indexes"}),"\n",(0,a.jsx)(s.li,{children:"Constraints"}),"\n",(0,a.jsx)(s.li,{children:"Row Level Security (RLS) policies"}),"\n",(0,a.jsx)(s.li,{children:"Functions and triggers"}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"backup-verification-checklist",children:"Backup Verification Checklist"}),"\n",(0,a.jsx)(s.h3,{id:"weekly-verification-every-monday",children:"Weekly Verification (Every Monday)"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"# 1. Check backup exists in Supabase dashboard\n# 2. Verify backup size is reasonable (> 1MB)\n# 3. Check backup timestamp is recent (< 24 hours old)\n# 4. Verify no errors in backup logs\n"})}),"\n",(0,a.jsx)(s.h3,{id:"monthly-restore-test-first-friday-of-month",children:"Monthly Restore Test (First Friday of Month)"}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"IMPORTANT:"})," Only perform restore tests on a staging database, never on production!"]}),"\n",(0,a.jsx)(s.h4,{id:"step-1-create-staging-database",children:"Step 1: Create Staging Database"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsx)(s.li,{children:"Go to Supabase Dashboard"}),"\n",(0,a.jsx)(s.li,{children:'Click "New Project"'}),"\n",(0,a.jsxs)(s.li,{children:["Name: ",(0,a.jsx)(s.code,{children:"accessibility-staging-restore-test"})]}),"\n",(0,a.jsx)(s.li,{children:"Same region as production"}),"\n",(0,a.jsx)(s.li,{children:"Wait for database to initialize"}),"\n"]}),"\n",(0,a.jsx)(s.h4,{id:"step-2-download-backup",children:"Step 2: Download Backup"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:["Go to ",(0,a.jsx)(s.strong,{children:"Settings \u2192 Backups"})]}),"\n",(0,a.jsx)(s.li,{children:"Select backup from 1 month ago"}),"\n",(0,a.jsx)(s.li,{children:'Click "Download"'}),"\n",(0,a.jsxs)(s.li,{children:["Save as ",(0,a.jsx)(s.code,{children:"backup-YYYY-MM-DD.sql"})]}),"\n"]}),"\n",(0,a.jsx)(s.h4,{id:"step-3-restore-to-staging",children:"Step 3: Restore to Staging"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"# Connect to staging database\npsql postgresql://user:password@staging-db.supabase.co:5432/postgres < backup-YYYY-MM-DD.sql\n"})}),"\n",(0,a.jsx)(s.h4,{id:"step-4-verify-restore",children:"Step 4: Verify Restore"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"# Check table counts\npsql postgresql://user:password@staging-db.supabase.co:5432/postgres -c \"\nSELECT \n  schemaname,\n  tablename,\n  (SELECT count(*) FROM information_schema.tables \n   WHERE table_schema = schemaname AND table_name = tablename) as row_count\nFROM pg_tables \nWHERE schemaname NOT IN ('pg_catalog', 'information_schema')\nORDER BY tablename;\n\"\n\n# Expected output:\n# sites: ~42 rows\n# sessions: ~5 rows\n# admin_users: ~1 row\n# api_keys: ~3 rows\n# activity_log: ~156 rows\n# app_documentation: ~8 rows\n# api_payloads: ~0 rows\n# score_history: ~84 rows\n"})}),"\n",(0,a.jsx)(s.h4,{id:"step-5-test-data-integrity",children:"Step 5: Test Data Integrity"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'# Check for data corruption\npsql postgresql://user:password@staging-db.supabase.co:5432/postgres -c "\n-- Check for orphaned records\nSELECT COUNT(*) FROM score_history \nWHERE site_id NOT IN (SELECT id FROM sites);\n\n-- Check for invalid dates\nSELECT COUNT(*) FROM sites \nWHERE created_at > NOW();\n\n-- Check for NULL required fields\nSELECT COUNT(*) FROM sites \nWHERE name IS NULL OR url IS NULL;\n"\n\n# All queries should return 0\n'})}),"\n",(0,a.jsx)(s.h4,{id:"step-6-test-application-connection",children:"Step 6: Test Application Connection"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"# Update .env to point to staging database\nVITE_SUPABASE_URL=https://staging-db.supabase.co\nVITE_SUPABASE_ANON_KEY=staging-key\n\n# Start application\nyarn dev\n\n# Test in browser:\n# 1. Navigate to http://localhost:5173\n# 2. Check dashboard loads\n# 3. Verify data displays correctly\n# 4. Test API endpoints\n"})}),"\n",(0,a.jsx)(s.h4,{id:"step-7-cleanup",children:"Step 7: Cleanup"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"# Delete staging database after successful test\n# Go to Supabase Dashboard \u2192 Settings \u2192 Delete Project\n"})}),"\n",(0,a.jsx)(s.h2,{id:"backup-disaster-recovery-plan",children:"Backup Disaster Recovery Plan"}),"\n",(0,a.jsx)(s.h3,{id:"if-production-database-is-corrupted",children:"If Production Database is Corrupted"}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.strong,{children:"Step 1: Assess Damage"})}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"# Check database status\ncurl https://accessibility.icjia.app/api/health\n\n# Check logs\npm2 logs icjia-accessibility-backend\n"})}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.strong,{children:"Step 2: Notify Team"})}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Email: ",(0,a.jsx)(s.a,{href:"mailto:ops@icjia.illinois.gov",children:"ops@icjia.illinois.gov"})]}),"\n",(0,a.jsx)(s.li,{children:"Slack: #accessibility-alerts"}),"\n",(0,a.jsx)(s.li,{children:'Status: "Database maintenance in progress"'}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.strong,{children:"Step 3: Restore from Backup"})}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsx)(s.li,{children:"Go to Supabase Dashboard"}),"\n",(0,a.jsx)(s.li,{children:"Select most recent backup"}),"\n",(0,a.jsx)(s.li,{children:'Click "Restore"'}),"\n",(0,a.jsx)(s.li,{children:"Confirm restoration"}),"\n",(0,a.jsx)(s.li,{children:"Wait for completion (5-15 minutes)"}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.strong,{children:"Step 4: Verify Restoration"})}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"# Check health endpoint\ncurl https://accessibility.icjia.app/api/health\n\n# Check data integrity\n# (Use same queries as restore test above)\n"})}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsx)(s.strong,{children:"Step 5: Notify Team"})}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsxs)(s.li,{children:["Email: ",(0,a.jsx)(s.a,{href:"mailto:ops@icjia.illinois.gov",children:"ops@icjia.illinois.gov"})]}),"\n",(0,a.jsx)(s.li,{children:"Slack: #accessibility-alerts"}),"\n",(0,a.jsx)(s.li,{children:'Status: "Database restored successfully"'}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"if-backup-is-corrupted",children:"If Backup is Corrupted"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsx)(s.li,{children:"Contact Supabase support"}),"\n",(0,a.jsx)(s.li,{children:"Request backup from 2+ days ago"}),"\n",(0,a.jsx)(s.li,{children:"Follow restore procedure above"}),"\n",(0,a.jsx)(s.li,{children:"Accept data loss from last 2 days"}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"backup-retention-policy",children:"Backup Retention Policy"}),"\n",(0,a.jsx)(s.h3,{id:"development",children:"Development"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Keep: 7 days"}),"\n",(0,a.jsx)(s.li,{children:"Test restore: Monthly"}),"\n",(0,a.jsx)(s.li,{children:"Cost: Free"}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"production",children:"Production"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Keep: 30 days (recommended)"}),"\n",(0,a.jsx)(s.li,{children:"Test restore: Monthly"}),"\n",(0,a.jsx)(s.li,{children:"Cost: ~$10/month"}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"archive",children:"Archive"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Keep: 1 year (optional)"}),"\n",(0,a.jsx)(s.li,{children:"Store: AWS S3 or similar"}),"\n",(0,a.jsx)(s.li,{children:"Cost: ~$1/month"}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"automated-backup-exports",children:"Automated Backup Exports"}),"\n",(0,a.jsx)(s.h3,{id:"daily-export-to-s3",children:"Daily Export to S3"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'#!/bin/bash\n# backup-to-s3.sh\n\nDATE=$(date +%Y-%m-%d)\nBACKUP_FILE="accessibility-backup-${DATE}.sql"\n\n# Export from Supabase\npg_dump postgresql://user:password@db.supabase.co:5432/postgres > $BACKUP_FILE\n\n# Upload to S3\naws s3 cp $BACKUP_FILE s3://icjia-backups/accessibility/\n\n# Cleanup local file\nrm $BACKUP_FILE\n\n# Log\necho "Backup completed: $BACKUP_FILE" >> /var/log/backups.log\n'})}),"\n",(0,a.jsx)(s.h3,{id:"setup-cron-job",children:"Setup Cron Job"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:"# Add to crontab\n0 3 * * * /usr/local/bin/backup-to-s3.sh\n"})}),"\n",(0,a.jsx)(s.h2,{id:"production-deployment-checklist",children:"Production Deployment Checklist"}),"\n",(0,a.jsxs)(s.ul,{className:"contains-task-list",children:["\n",(0,a.jsxs)(s.li,{className:"task-list-item",children:[(0,a.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Supabase backups enabled"]}),"\n",(0,a.jsxs)(s.li,{className:"task-list-item",children:[(0,a.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Backup retention set to 30 days"]}),"\n",(0,a.jsxs)(s.li,{className:"task-list-item",children:[(0,a.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Backup schedule verified (daily at 2 AM UTC)"]}),"\n",(0,a.jsxs)(s.li,{className:"task-list-item",children:[(0,a.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Staging database created for restore testing"]}),"\n",(0,a.jsxs)(s.li,{className:"task-list-item",children:[(0,a.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Monthly restore test scheduled"]}),"\n",(0,a.jsxs)(s.li,{className:"task-list-item",children:[(0,a.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Restore test procedure documented"]}),"\n",(0,a.jsxs)(s.li,{className:"task-list-item",children:[(0,a.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Team trained on restore procedure"]}),"\n",(0,a.jsxs)(s.li,{className:"task-list-item",children:[(0,a.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Disaster recovery plan reviewed"]}),"\n",(0,a.jsxs)(s.li,{className:"task-list-item",children:[(0,a.jsx)(s.input,{type:"checkbox",disabled:!0})," ","S3 backup exports configured (optional)"]}),"\n",(0,a.jsxs)(s.li,{className:"task-list-item",children:[(0,a.jsx)(s.input,{type:"checkbox",disabled:!0})," ","Backup monitoring alerts configured"]}),"\n"]}),"\n",(0,a.jsx)(s.h2,{id:"monitoring-backup-health",children:"Monitoring Backup Health"}),"\n",(0,a.jsx)(s.h3,{id:"supabase-backup-alerts",children:"Supabase Backup Alerts"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:["Go to ",(0,a.jsx)(s.strong,{children:"Settings \u2192 Backups"})]}),"\n",(0,a.jsx)(s.li,{children:"Enable email notifications"}),"\n",(0,a.jsxs)(s.li,{children:["Alert on:","\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:"Backup failure"}),"\n",(0,a.jsx)(s.li,{children:"Backup size anomaly"}),"\n",(0,a.jsx)(s.li,{children:"Backup delay"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsx)(s.h3,{id:"custom-monitoring",children:"Custom Monitoring"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"language-bash",children:'#!/bin/bash\n# check-backup-age.sh\n\nBACKUP_AGE=$(curl -s https://app.supabase.com/api/backups | jq \'.backups[0].created_at\')\nHOURS_OLD=$(( ($(date +%s) - $(date -d "$BACKUP_AGE" +%s)) / 3600 ))\n\nif [ $HOURS_OLD -gt 24 ]; then\n  echo "ALERT: Backup is $HOURS_OLD hours old"\n  # Send alert\nfi\n'})}),"\n",(0,a.jsx)(s.h2,{id:"see-also",children:"See Also"}),"\n",(0,a.jsxs)(s.ul,{children:["\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"/docs/docs/deployment/laravel-forge",children:"Deployment Guide - Laravel Forge"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"/docs/docs/deployment/coolify-deployment",children:"Deployment Guide - Coolify"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"/docs/docs/deployment/health-check-monitoring",children:"Health Check Monitoring"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"https://supabase.com/docs/guides/database/backups",children:"Supabase Backup Documentation"})}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,t.R)(),...e.components};return s?(0,a.jsx)(s,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);