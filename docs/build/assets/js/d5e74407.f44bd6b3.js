"use strict";(self.webpackChunkicjia_accessibility_docs=self.webpackChunkicjia_accessibility_docs||[]).push([[477],{3023:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>o});var s=i(3696);const r={},t=s.createContext(r);function l(e){const n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),s.createElement(t.Provider,{value:n},e.children)}},3195:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"deployment/laravel-forge","title":"Laravel Forge Deployment Guide","description":"Complete guide to deploying the ICJIA Accessibility Status Portal on a Laravel Forge server.","source":"@site/docs/deployment/laravel-forge.md","sourceDirName":"deployment","slug":"/deployment/laravel-forge","permalink":"/docs/docs/deployment/laravel-forge","draft":false,"unlisted":false,"editUrl":"https://github.com/ICJIA/icjia-accessibility-status/tree/main/docs/docs/deployment/laravel-forge.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Environment Verification","permalink":"/docs/docs/deployment/environment-verification"},"next":{"title":"Automated Deployment Setup","permalink":"/docs/docs/deployment/automated-deployment-setup"}}');var r=i(2540),t=i(3023);const l={},o="Laravel Forge Deployment Guide",c={},a=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Important Notes for Single Domain Setup",id:"important-notes-for-single-domain-setup",level:2},{value:"Step 1: Create a New Site in Forge",id:"step-1-create-a-new-site-in-forge",level:2},{value:"Step 2: Configure Git Repository",id:"step-2-configure-git-repository",level:2},{value:"Step 3: Set Environment Variables",id:"step-3-set-environment-variables",level:2},{value:"Step 4: Create Deployment Script",id:"step-4-create-deployment-script",level:2},{value:"Step 5: Configure Nginx",id:"step-5-configure-nginx",level:2},{value:"Step 6: Install PM2 and Configure",id:"step-6-install-pm2-and-configure",level:2},{value:"Step 7: Initial Setup (First Time Only)",id:"step-7-initial-setup-first-time-only",level:2},{value:"Step 8: Deploy",id:"step-8-deploy",level:2},{value:"Step 9: Verify Deployment",id:"step-9-verify-deployment",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Services not starting",id:"services-not-starting",level:3},{value:"Build failures",id:"build-failures",level:3},{value:"Port conflicts",id:"port-conflicts",level:3},{value:"Frontend shows blank page or 404",id:"frontend-shows-blank-page-or-404",level:3},{value:"API returns 502 Bad Gateway",id:"api-returns-502-bad-gateway",level:3},{value:"Supabase connection errors",id:"supabase-connection-errors",level:3},{value:"Automatic Deployments",id:"automatic-deployments",level:2},{value:"Monitoring",id:"monitoring",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"laravel-forge-deployment-guide",children:"Laravel Forge Deployment Guide"})}),"\n",(0,r.jsx)(n.p,{children:"Complete guide to deploying the ICJIA Accessibility Status Portal on a Laravel Forge server."}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Laravel Forge account with a new server instantiated"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 GitHub repository access (SSH key configured in Forge)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Supabase project with credentials (URL and anon key)"}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 Domain name pointing to your Forge server (e.g., ",(0,r.jsx)(n.code,{children:"accessibility.icjia.app"}),")"]}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Node.js 20+ (Forge installs this automatically)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Yarn 1.22.22 (will be installed during deployment)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"important-notes-for-single-domain-setup",children:"Important Notes for Single Domain Setup"}),"\n",(0,r.jsxs)(n.p,{children:["This guide uses a ",(0,r.jsx)(n.strong,{children:"single domain"})," (",(0,r.jsx)(n.code,{children:"accessibility.icjia.app"}),") to serve:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Frontend"})," (React SPA) at ",(0,r.jsx)(n.code,{children:"/"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Backend API"})," at ",(0,r.jsx)(n.code,{children:"/api/"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Documentation"})," at ",(0,r.jsx)(n.code,{children:"/docs/"})]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"All three services run on the same server but on different ports (5173, 3001, 3002), with Nginx routing traffic to the appropriate service based on the URL path."}),"\n",(0,r.jsx)(n.h2,{id:"step-1-create-a-new-site-in-forge",children:"Step 1: Create a New Site in Forge"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Log in to Laravel Forge"})," \u2192 ",(0,r.jsx)(n.a,{href:"https://forge.laravel.com",children:"https://forge.laravel.com"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:'Click "Create Site"'})," on your server"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Configure the site:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Domain:"})," ",(0,r.jsx)(n.code,{children:"accessibility.yourdomain.com"})," (or your preferred domain)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Project Type:"})," ",(0,r.jsx)(n.code,{children:"Node.js"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Node Version:"})," ",(0,r.jsx)(n.code,{children:"20"})," (or latest LTS)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Root Directory:"})," ",(0,r.jsx)(n.code,{children:"/public"})," (leave as default)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:'Click "Create Site"'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Forge will automatically:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Create the site directory at ",(0,r.jsx)(n.code,{children:"/home/forge/accessibility.yourdomain.com"})]}),"\n",(0,r.jsx)(n.li,{children:"Install Node.js and npm"}),"\n",(0,r.jsx)(n.li,{children:"Set up SSL certificate (if domain is configured)"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"step-2-configure-git-repository",children:"Step 2: Configure Git Repository"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"In Forge, go to Site Details \u2192 Repository"})}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Connect GitHub:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Repository:"})," ",(0,r.jsx)(n.code,{children:"ICJIA/icjia-accessibility-status"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Branch:"})," ",(0,r.jsx)(n.code,{children:"main"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Composer:"})," Uncheck (not needed)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:'Click "Connect Repository"'})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Forge will clone the repository to ",(0,r.jsx)(n.code,{children:"/home/forge/accessibility.yourdomain.com"})]}),"\n",(0,r.jsx)(n.h2,{id:"step-3-set-environment-variables",children:"Step 3: Set Environment Variables"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Go to Site Details \u2192 Environment"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Add the following environment variables:"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"################################################################################\n# SUPABASE CONFIGURATION [REQUIRED]\n################################################################################\nVITE_SUPABASE_URL=https://your-project-ref.supabase.co\nVITE_SUPABASE_ANON_KEY=your-supabase-anon-key\n\n################################################################################\n# FRONTEND CONFIGURATION [REQUIRED]\n################################################################################\nFRONTEND_URL=https://accessibility.icjia.app\nVITE_DOCS_URL=/docs/\n\n################################################################################\n# API CONFIGURATION [REQUIRED]\n################################################################################\nVITE_API_URL=https://accessibility.icjia.app/api\n\n################################################################################\n# SERVER CONFIGURATION [OPTIONAL]\n################################################################################\nNODE_ENV=production\nPORT=3001\n\n################################################################################\n# RATE LIMITING CONFIGURATION [OPTIONAL]\n################################################################################\nLOGIN_RATE_LIMIT_WINDOW_MS=600000\nLOGIN_RATE_LIMIT_MAX_ATTEMPTS=5\nAPI_KEY_RATE_LIMIT_WINDOW_MS=3600000\nAPI_KEY_RATE_LIMIT_MAX_REQUESTS=100\nSESSION_RATE_LIMIT_WINDOW_MS=3600000\nSESSION_RATE_LIMIT_MAX_SESSIONS=10\nGENERAL_RATE_LIMIT_WINDOW_MS=3600000\nGENERAL_RATE_LIMIT_MAX_REQUESTS=1000\n\n################################################################################\n# API KEY ROTATION CONFIGURATION [OPTIONAL]\n################################################################################\nAPI_KEY_ROTATION_GRACE_PERIOD_DAYS=10\nKEY_DEACTIVATION_CHECK_INTERVAL_MS=3600000\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Important Production Configuration Notes:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"VITE_SUPABASE_URL"}),": Get from Supabase dashboard \u2192 Settings \u2192 API \u2192 Project URL"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"VITE_SUPABASE_ANON_KEY"}),": Get from Supabase dashboard \u2192 Settings \u2192 API \u2192 Project API Keys \u2192 anon (public)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"FRONTEND_URL"}),": Must match your production domain (used for CORS configuration)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"VITE_API_URL"}),": Must match your production domain with ",(0,r.jsx)(n.code,{children:"/api"})," path"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"VITE_DOCS_URL"}),": Set to ",(0,r.jsx)(n.code,{children:"/docs/"})," in production (served from same domain via Nginx)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"NODE_ENV"}),": Must be ",(0,r.jsx)(n.code,{children:"production"})," for optimized builds"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"PORT"}),": Backend port (3001 is standard, proxied by Nginx)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Rate Limiting"}),": Adjust based on your expected traffic and security requirements"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Single Source of Truth:"})}),"\n",(0,r.jsx)(n.p,{children:"All domain names and ports are now configured via environment variables. Any changes to these values will automatically ripple through the entire application:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Frontend proxy configuration"}),"\n",(0,r.jsx)(n.li,{children:"Navigation links"}),"\n",(0,r.jsx)(n.li,{children:"API endpoints"}),"\n",(0,r.jsx)(n.li,{children:"Documentation links"}),"\n"]}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:'Click "Save"'})}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"step-4-create-deployment-script",children:"Step 4: Create Deployment Script"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Go to Site Details \u2192 Deployment Script"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Replace the default script with:"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\nset -e\n\ncd /home/forge/accessibility.icjia.app\n\necho "=== Starting Deployment ==="\necho "Time: $(date)"\n\n# Pull latest code\necho "Pulling latest code from GitHub..."\ngit pull origin main\n\n# Install dependencies (using Yarn)\necho "Installing dependencies..."\nyarn install --production\n\n# Build frontend and documentation\necho "Building frontend and documentation..."\nyarn build\n\n# Verify builds completed\nif [ ! -d "dist" ]; then\n  echo "ERROR: Frontend build failed - dist directory not found"\n  exit 1\nfi\n\necho "Frontend build successful"\n\n# Restart backend with PM2\necho "Restarting backend services..."\npm2 restart icjia-accessibility-backend || pm2 start ecosystem.config.js\npm2 save\n\n# Verify services\necho "Verifying services..."\npm2 status\n\necho "=== Deployment Complete ==="\necho "Frontend: https://accessibility.icjia.app"\necho "API: https://accessibility.icjia.app/api/health"\necho "Docs: https://accessibility.icjia.app/docs"\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:'Click "Save"'})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Note:"})," This script will:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Pull the latest code from the ",(0,r.jsx)(n.code,{children:"main"})," branch"]}),"\n",(0,r.jsx)(n.li,{children:"Install production dependencies only"}),"\n",(0,r.jsx)(n.li,{children:"Build the frontend and documentation"}),"\n",(0,r.jsx)(n.li,{children:"Restart the backend services with PM2"}),"\n",(0,r.jsx)(n.li,{children:"Verify all services are running"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"step-5-configure-nginx",children:"Step 5: Configure Nginx"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Go to Site Details \u2192 Nginx"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Replace the Nginx configuration with:"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-nginx",children:'server {\n    listen 80;\n    listen [::]:80;\n    server_name accessibility.icjia.app;\n    root /home/forge/accessibility.icjia.app/dist;\n\n    # SSL configuration (auto-configured by Forge with Let\'s Encrypt)\n    listen 443 ssl http2;\n    listen [::]:443 ssl http2;\n    ssl_certificate /etc/nginx/ssl/accessibility.icjia.app/certificate.crt;\n    ssl_certificate_key /etc/nginx/ssl/accessibility.icjia.app/private.key;\n\n    # Redirect HTTP to HTTPS\n    if ($scheme != "https") {\n        return 301 https://$server_name$request_uri;\n    }\n\n    # Logging\n    access_log /var/log/nginx/accessibility.icjia.app-access.log;\n    error_log /var/log/nginx/accessibility.icjia.app-error.log;\n\n    # Frontend SPA routing (React app at /)\n    location / {\n        try_files $uri $uri/ /index.html;\n        add_header Cache-Control "public, max-age=3600";\n        add_header X-Content-Type-Options "nosniff";\n        add_header X-Frame-Options "SAMEORIGIN";\n    }\n\n    # API routes - proxy to backend (Express on port 3001)\n    # Note: Use 127.0.0.1 (not localhost) for Nginx upstream proxying\n    # This avoids DNS resolution overhead and is more reliable in production\n    location /api/ {\n        proxy_pass http://127.0.0.1:3001;\n        proxy_http_version 1.1;\n        proxy_set_header Upgrade $http_upgrade;\n        proxy_set_header Connection \'upgrade\';\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_cache_bypass $http_upgrade;\n\n        # Timeouts for API requests\n        proxy_connect_timeout 60s;\n        proxy_send_timeout 60s;\n        proxy_read_timeout 60s;\n    }\n\n    # Documentation routes - proxy to Docusaurus (port 3002)\n    location /docs/ {\n        proxy_pass http://127.0.0.1:3002/;\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n\n        # Timeouts for docs\n        proxy_connect_timeout 60s;\n        proxy_send_timeout 60s;\n        proxy_read_timeout 60s;\n    }\n\n    # Deny access to sensitive files\n    location ~ /\\. {\n        deny all;\n        access_log off;\n        log_not_found off;\n    }\n\n    # Deny access to .env and other sensitive files\n    location ~ /\\.(env|git|htaccess)$ {\n        deny all;\n        access_log off;\n        log_not_found off;\n    }\n\n    # Cache static assets (frontend build files)\n    location ~* \\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {\n        expires 1y;\n        add_header Cache-Control "public, immutable";\n        access_log off;\n    }\n\n    # Gzip compression\n    gzip on;\n    gzip_vary on;\n    gzip_proxied any;\n    gzip_comp_level 6;\n    gzip_types text/plain text/css text/xml text/javascript\n               application/json application/javascript application/xml+rss\n               application/rss+xml font/truetype font/opentype\n               application/vnd.ms-fontobject image/svg+xml;\n}\n'})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:'Click "Save"'})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Important Notes:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Replace ",(0,r.jsx)(n.code,{children:"accessibility.icjia.app"})," with your actual domain"]}),"\n",(0,r.jsx)(n.li,{children:"Nginx will automatically handle SSL certificates (Forge uses Let's Encrypt)"}),"\n",(0,r.jsxs)(n.li,{children:["The configuration routes traffic based on URL path:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/"})," \u2192 Frontend (React SPA)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/api/"})," \u2192 Backend (Express API)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"/docs/"})," \u2192 Documentation (Docusaurus)"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.li,{children:"All three services run on localhost but on different ports"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"step-6-install-pm2-and-configure",children:"Step 6: Install PM2 and Configure"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"SSH into your Forge server:"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh forge@your-server-ip\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"2",children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Install PM2 globally:"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"npm install -g pm2\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Create PM2 ecosystem configuration:"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd /home/forge/accessibility.icjia.app\n\n# Create the ecosystem configuration file\ncat > ecosystem.config.js << 'EOF'\nmodule.exports = {\n  apps: [\n    {\n      name: 'icjia-accessibility-backend',\n      script: 'server/index.ts',\n      interpreter: 'tsx',\n      instances: 1,\n      exec_mode: 'fork',\n      watch: false,\n      env: {\n        NODE_ENV: 'production',\n        PORT: 3001\n      },\n      error_file: '/home/forge/.pm2/logs/backend-error.log',\n      out_file: '/home/forge/.pm2/logs/backend-out.log',\n      log_date_format: 'YYYY-MM-DD HH:mm:ss Z',\n      merge_logs: true,\n      autorestart: true,\n      max_restarts: 10,\n      min_uptime: '10s',\n      max_memory_restart: '500M'\n    },\n    {\n      name: 'icjia-accessibility-docs',\n      script: 'yarn',\n      args: 'workspace icjia-accessibility-docs start',\n      instances: 1,\n      exec_mode: 'fork',\n      watch: false,\n      env: {\n        NODE_ENV: 'production',\n        PORT: 3002\n      },\n      error_file: '/home/forge/.pm2/logs/docs-error.log',\n      out_file: '/home/forge/.pm2/logs/docs-out.log',\n      log_date_format: 'YYYY-MM-DD HH:mm:ss Z',\n      merge_logs: true,\n      autorestart: true,\n      max_restarts: 10,\n      min_uptime: '10s'\n    }\n  ]\n};\nEOF\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"4",children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Start services with PM2:"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Start all services\npm2 start ecosystem.config.js\n\n# Save PM2 process list (so it restarts on server reboot)\npm2 save\n\n# Setup PM2 to start on system boot\npm2 startup\n\n# Verify services are running\npm2 status\n\n# View logs\npm2 logs\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Important:"})," The ",(0,r.jsx)(n.code,{children:"pm2 startup"})," command will output instructions. Follow them to ensure PM2 starts automatically when the server reboots."]}),"\n",(0,r.jsx)(n.h2,{id:"step-7-initial-setup-first-time-only",children:"Step 7: Initial Setup (First Time Only)"}),"\n",(0,r.jsx)(n.p,{children:"Before deploying, you need to set up the environment file and install Yarn:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh forge@your-server-ip\n\ncd /home/forge/accessibility.icjia.app\n\n# Install Yarn globally (if not already installed)\nnpm install -g yarn@1.22.22\n\n# Verify Yarn installation\nyarn --version\n\n# Create .env file from sample\ncp .env.sample .env\n\n# Edit .env with your production values\nnano .env\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"In the .env file, update the following production values:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"################################################################################\n# SUPABASE CONFIGURATION [REQUIRED]\n################################################################################\nVITE_SUPABASE_URL=https://your-project-ref.supabase.co\nVITE_SUPABASE_ANON_KEY=your-supabase-anon-key\n\n################################################################################\n# FRONTEND CONFIGURATION [REQUIRED]\n################################################################################\nFRONTEND_URL=https://accessibility.icjia.app\nVITE_DOCS_URL=/docs/\n\n################################################################################\n# API CONFIGURATION [REQUIRED]\n################################################################################\nVITE_API_URL=https://accessibility.icjia.app/api\n\n################################################################################\n# SERVER CONFIGURATION [OPTIONAL]\n################################################################################\nNODE_ENV=production\nPORT=3001\n\n################################################################################\n# RATE LIMITING CONFIGURATION [OPTIONAL]\n################################################################################\nLOGIN_RATE_LIMIT_WINDOW_MS=600000\nLOGIN_RATE_LIMIT_MAX_ATTEMPTS=5\nAPI_KEY_RATE_LIMIT_WINDOW_MS=3600000\nAPI_KEY_RATE_LIMIT_MAX_REQUESTS=100\nSESSION_RATE_LIMIT_WINDOW_MS=3600000\nSESSION_RATE_LIMIT_MAX_SESSIONS=10\nGENERAL_RATE_LIMIT_WINDOW_MS=3600000\nGENERAL_RATE_LIMIT_MAX_REQUESTS=1000\n\n################################################################################\n# API KEY ROTATION CONFIGURATION [OPTIONAL]\n################################################################################\nAPI_KEY_ROTATION_GRACE_PERIOD_DAYS=10\nKEY_DEACTIVATION_CHECK_INTERVAL_MS=3600000\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Key Changes for Production:"})}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"VITE_SUPABASE_URL"})," - Replace ",(0,r.jsx)(n.code,{children:"your-project-ref"})," with your actual Supabase project reference"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"VITE_SUPABASE_ANON_KEY"})," - Replace with your actual Supabase anon key (from Settings \u2192 API)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"FRONTEND_URL"})," - Set to your production domain (e.g., ",(0,r.jsx)(n.code,{children:"https://accessibility.icjia.app"}),")"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"VITE_API_URL"})," - Set to your production domain with ",(0,r.jsx)(n.code,{children:"/api"})," path"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"VITE_DOCS_URL"})," - Set to ",(0,r.jsx)(n.code,{children:"/docs/"})," (served from same domain via Nginx)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"NODE_ENV"})," - Must be ",(0,r.jsx)(n.code,{children:"production"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Rate Limiting"})," - Adjust values based on your expected traffic"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"Save the file (Ctrl+X, then Y, then Enter in nano)."}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Verification:"})}),"\n",(0,r.jsx)(n.p,{children:"After saving, verify the file has all required values:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'grep -E "^[A-Z_]+=" .env | wc -l  # Should show 17 variables\ncat .env | grep "VITE_SUPABASE_URL\\|FRONTEND_URL\\|VITE_API_URL\\|NODE_ENV"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"step-8-deploy",children:"Step 8: Deploy"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:'In Forge, click "Deploy Now"'})," on the site"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Monitor deployment:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Go to ",(0,r.jsx)(n.strong,{children:"Site Details \u2192 Deployment History"})]}),"\n",(0,r.jsx)(n.li,{children:"Watch the deployment progress"}),"\n",(0,r.jsx)(n.li,{children:"Check logs if there are any errors"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Verify services are running:"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh forge@your-server-ip\n\n# Check PM2 status\npm2 status\n\n# View real-time logs\npm2 logs\n\n# Check if ports are listening\nlsof -i :3001\nlsof -i :3002\n"})}),"\n",(0,r.jsx)(n.h2,{id:"step-9-verify-deployment",children:"Step 9: Verify Deployment"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Check frontend:"})," ",(0,r.jsx)(n.a,{href:"https://accessibility.icjia.app",children:"https://accessibility.icjia.app"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Should display the React application"}),"\n",(0,r.jsx)(n.li,{children:"Check browser console for any errors"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Check API health:"})," ",(0,r.jsx)(n.a,{href:"https://accessibility.icjia.app/api/health",children:"https://accessibility.icjia.app/api/health"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Should return JSON with status information"}),"\n",(0,r.jsx)(n.li,{children:"Verifies backend is running and connected to Supabase"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Check documentation:"})," ",(0,r.jsx)(n.a,{href:"https://accessibility.icjia.app/docs",children:"https://accessibility.icjia.app/docs"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Should display the Docusaurus documentation site"}),"\n",(0,r.jsx)(n.li,{children:"Verify sidebar and navigation work"}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Check logs for errors:"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh forge@your-server-ip\n\n# View backend logs\npm2 logs icjia-accessibility-backend\n\n# View docs logs\npm2 logs icjia-accessibility-docs\n\n# View Nginx logs\nsudo tail -f /var/log/nginx/accessibility.icjia.app-error.log\n"})}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"services-not-starting",children:"Services not starting"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# SSH into server\nssh forge@your-server-ip\n\n# Check PM2 status\npm2 status\n\n# View logs\npm2 logs icjia-accessibility-backend\npm2 logs icjia-accessibility-docs\n\n# Restart services\npm2 restart all\n\n# If still not working, check if .env file exists\ncat /home/forge/accessibility.icjia.app/.env\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Common causes:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Missing ",(0,r.jsx)(n.code,{children:".env"})," file - Create it with ",(0,r.jsx)(n.code,{children:"cp .env.sample .env"})]}),"\n",(0,r.jsxs)(n.li,{children:["Missing Supabase credentials - Check ",(0,r.jsx)(n.code,{children:"VITE_SUPABASE_URL"})," and ",(0,r.jsx)(n.code,{children:"VITE_SUPABASE_ANON_KEY"})]}),"\n",(0,r.jsxs)(n.li,{children:["Port already in use - Check with ",(0,r.jsx)(n.code,{children:"lsof -i :3001"})," and ",(0,r.jsx)(n.code,{children:"lsof -i :3002"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"build-failures",children:"Build failures"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# SSH into server\nssh forge@your-server-ip\n\n# Navigate to site directory\ncd /home/forge/accessibility.icjia.app\n\n# Check if Yarn is installed\nyarn --version\n\n# Install Yarn if needed\nnpm install -g yarn@1.22.22\n\n# Try building manually\nyarn install --production\nyarn build\n\n# Check if dist directory was created\nls -la dist/\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Common causes:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Yarn not installed - Install with ",(0,r.jsx)(n.code,{children:"npm install -g yarn@1.22.22"})]}),"\n",(0,r.jsxs)(n.li,{children:["Missing dependencies - Run ",(0,r.jsx)(n.code,{children:"yarn install --production"})]}),"\n",(0,r.jsxs)(n.li,{children:["Insufficient disk space - Check with ",(0,r.jsx)(n.code,{children:"df -h"})]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"port-conflicts",children:"Port conflicts"}),"\n",(0,r.jsx)(n.p,{children:"Ensure ports 3001 and 3002 are not in use:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"lsof -i :3001\nlsof -i :3002\n\n# If ports are in use, kill the process\nkill -9 <PID>\n\n# Then restart PM2\npm2 restart all\n"})}),"\n",(0,r.jsx)(n.h3,{id:"frontend-shows-blank-page-or-404",children:"Frontend shows blank page or 404"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check if frontend build exists\nls -la /home/forge/accessibility.icjia.app/dist/\n\n# Check Nginx configuration\nsudo nginx -t\n\n# View Nginx error logs\nsudo tail -f /var/log/nginx/accessibility.icjia.app-error.log\n\n# Restart Nginx\nsudo systemctl restart nginx\n"})}),"\n",(0,r.jsx)(n.h3,{id:"api-returns-502-bad-gateway",children:"API returns 502 Bad Gateway"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check if backend is running\npm2 status\n\n# Check backend logs\npm2 logs icjia-accessibility-backend\n\n# Verify backend is listening on port 3001\nlsof -i :3001\n\n# Check Nginx logs\nsudo tail -f /var/log/nginx/accessibility.icjia.app-error.log\n"})}),"\n",(0,r.jsx)(n.h3,{id:"supabase-connection-errors",children:"Supabase connection errors"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Check .env file has correct credentials\ncat /home/forge/accessibility.icjia.app/.env | grep SUPABASE\n\n# Test Supabase connection\ncurl https://your-project-ref.supabase.co/rest/v1/\n\n# Check backend logs for database errors\npm2 logs icjia-accessibility-backend | grep -i "supabase\\|database\\|error"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"automatic-deployments",children:"Automatic Deployments"}),"\n",(0,r.jsx)(n.p,{children:"Forge can automatically deploy when you push to GitHub:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Go to Site Details \u2192 Deployment"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:'Enable "Auto Deploy"'})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Select branch:"})," ",(0,r.jsx)(n.code,{children:"main"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Now every push to ",(0,r.jsx)(n.code,{children:"main"})," will automatically trigger a deployment!"]}),"\n",(0,r.jsx)(n.h2,{id:"monitoring",children:"Monitoring"}),"\n",(0,r.jsx)(n.p,{children:"Monitor your application in Forge:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Site Details \u2192 Monitoring"})," - View CPU, memory, and disk usage"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Site Details \u2192 Logs"})," - View Nginx and application logs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"SSH into server"})," - Use ",(0,r.jsx)(n.code,{children:"pm2 logs"})," for real-time logs"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Set up SSL certificate (Forge handles this automatically)"}),"\n",(0,r.jsx)(n.li,{children:"Configure backups in Forge"}),"\n",(0,r.jsx)(n.li,{children:"Set up monitoring alerts"}),"\n",(0,r.jsx)(n.li,{children:"Configure custom domain if needed"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);